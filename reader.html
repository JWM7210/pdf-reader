<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PDF Reader</title>

    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.14.305/pdf.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
            background: #f2f2f2;
            transition: background 0.3s, color 0.3s;
        }

        canvas {
            border: 1px solid #ccc;
            margin-top: 10px;
            max-width: 95%;
            background: white;
            transition: filter 0.3s;
        }

        #controls {
            margin-top: 15px;
        }

        button {
            padding: 7px 14px;
            margin: 3px;
            border: none;
            background: #333;
            color: white;
            border-radius: 6px;
            cursor: pointer;
        }

        button:hover {
            background: #555;
        }

        /* dark mode */
        .dark {
            background: #1c1c1c;
            color: white;
        }

        .dark canvas {
            filter: invert(1) hue-rotate(180deg);
        }
    </style>
</head>

<body>
    <h2>Online PDF Reader</h2>

    <input type="file" id="file-input" accept="application/pdf"><br>

    <canvas id="pdf-canvas"></canvas>

    <div id="controls" style="display:none;">
        <br>
        <button id="prev">Prev</button>
        <span id="page-num">1</span> / <span id="page-count">?</span>
        <button id="next">Next</button>
        <br><br>

        <!-- Zoom controls -->
        <button id="zoom-in">Zoom +</button>
        <button id="zoom-out">Zoom âˆ’</button>
        <button id="zoom-reset">Reset Zoom</button>

        <!-- Dark mode -->
        <br><br>
        <button id="dark-mode">Toggle Dark Mode</button>
    </div>

    <script>
    

function queueRenderPage(num) {
    if (pageIsRendering) {
        pageNumIsPending = num;
    } else {
        renderPage(num);
    }
    localStorage.setItem("savedPage", num);
}

        let pdfDoc = null,
            pageNum = 1,
            canvas = document.getElementById("pdf-canvas"),
            ctx = canvas.getContext("2d"),
            isDark = false,
            scale = 1.3,
            pageIsRendering = false,
            pageNumIsPending = null;

        const controls = document.getElementById("controls");

        function renderPage(num) {
            pageIsRendering = true;

            pdfDoc.getPage(num).then(page => {
                const viewport = page.getViewport({ scale });
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                const renderCtx = { canvasContext: ctx, viewport: viewport };

                page.render(renderCtx).promise.then(() => {
                    pageIsRendering = false;

                    if (pageNumIsPending !== null) {
                        renderPage(pageNumIsPending);
                        pageNumIsPending = null;
                    }
                });

                document.getElementById("page-num").textContent = num;
            });
        }

        function queueRenderPage(num) {
            if (pageIsRendering) {
                pageNumIsPending = num;
            } else {
                renderPage(num);
            }
        }

        document.getElementById("prev").onclick = () => {
            if (pageNum <= 1) return;
            pageNum--;
            queueRenderPage(pageNum);
        };

        document.getElementById("next").onclick = () => {
            if (pageNum >= pdfDoc.numPages) return;
            pageNum++;
            queueRenderPage(pageNum);
        };

        document.getElementById("zoom-in").onclick = () => {
            scale += 0.2;
            queueRenderPage(pageNum);
        };

        document.getElementById("zoom-out").onclick = () => {
            if (scale > 0.4) scale -= 0.2;
            queueRenderPage(pageNum);
        };

        document.getElementById("zoom-reset").onclick = () => {
            scale = 1.3;
            queueRenderPage(pageNum);
        };

        document.getElementById("dark-mode").onclick = () => {
            document.body.classList.toggle("dark");
            isDark = !isDark;
        };

        // File upload
        document.getElementById("file-input").addEventListener("change", function () {
            const file = this.files[0];
            if (!file) return;

            const reader = new FileReader();

            reader.onload = function () {
                const typedArray = new Uint8Array(this.result);

                pdfjsLib.getDocument(typedArray).promise.then(pdf => {
                    pdfDoc = pdf;
                    pageNum = 1;

                    document.getElementById("page-count").textContent = pdf.numPages;
                    controls.style.display = "Block";

                    renderPage(pageNum);
                });
            };

            reader.readAsArrayBuffer(file);
        });

        /* MOBILE PINCH-TO-ZOOM */
        let initialDistance = 0;
        let lastScale = 1;

        canvas.addEventListener("touchmove", e => {
            if (e.touches.length === 2) {
                e.preventDefault();
                let dx = e.touches[0].pageX - e.touches[1].pageX;
                let dy = e.touches[0].pageY - e.touches[1].pageY;
                let dist = Math.sqrt(dx * dx + dy * dy);

                if (!initialDistance) {
                    initialDistance = dist;
                } else {
                    let delta = dist - initialDistance;
                    scale = Math.max(0.5, Math.min(4, scale + delta / 400));
                    queueRenderPage(pageNum);
                }
            }
        });

        canvas.addEventListener("touchend", () => {
            initialDistance = 0;
        });
    </script>
</body>
</html>
